import useGetUserInfo from '@/hooks/useGetUserInfo';
import { getLocaleStorageUtil, removeLocaleStorageUtil } from '@/utils/helper';
import { Popover, Tab, Transition } from '@headlessui/react';
import { getVersion } from '@tauri-apps/api/app';
import { invoke } from '@tauri-apps/api/tauri';
import classNames from 'classnames';
import dynamic from 'next/dynamic';
import { useRouter } from 'next/router';
import { Fragment, useEffect, useState } from 'react';

const DynamicTopRightOption = dynamic(
  () => import('@/components/TopRightOption'),
  {
    ssr: false,
  }
);

type LayoutProps = {
  children: React.ReactNode;
};

const Layout = ({ children }: LayoutProps) => {
  const router = useRouter();
  const [local_uid, setlocal_uid] = useState<string | undefined>(undefined);
  const [appVersion, setappVersion] = useState('');
  useEffect(() => {
    setlocal_uid(getLocaleStorageUtil('uid'));
    getVersion().then(appVersion => {
      setappVersion(appVersion);
    });
  }, []);
  const { user_info } = useGetUserInfo(local_uid);

  return (
    <div className={classNames(' h-screen flex flex-col')}>
      <div
        data-tauri-drag-region
        className={classNames(
          'h-[43px] shrink-0 bg-gradient-to-r from-[#394A6A] to-[#293451] px-[10px] py-2 flex justify-between items-center '
        )}
      >
        <Popover className="relative">
          <>
            <Popover.Button
              className={`
                flex space-x-2 group items-center focus:outline-none `}
            >
              <div
                className={classNames(
                  'h-[27px] w-[27px] rounded-full bg-green-300 '
                )}
              ></div>
              <span className={classNames('text-white')}>
                {user_info?.[0]?.name}
              </span>
            </Popover.Button>
            <Transition
              as={Fragment}
              enter="transition ease-out duration-200"
              enterFrom="opacity-0 translate-y-1"
              enterTo="opacity-100 translate-y-0"
              leave="transition ease-in duration-150"
              leaveFrom="opacity-100 translate-y-0"
              leaveTo="opacity-0 translate-y-1"
            >
              <Popover.Panel className="absolute left-0 z-10 mt-3 w-screen max-w-[240px]  transform px-4 sm:px-0 ">
                <div className="overflow-hidden rounded-lg shadow-lg ring-1 ring-black ring-opacity-5">
                  <div className="relative grid gap-8 bg-white p-2">
                    <a
                      onClick={() => {
                        removeLocaleStorageUtil('uid');
                        removeLocaleStorageUtil('gid');
                        invoke('log_out', {});
                        router.push('/login');
                      }}
                      className=" flex items-center rounded-lg bg-red-500 hover:cursor-pointer py-2 transition duration-150 ease-in-out focus:outline-none"
                    >
                      <div className="ml-4">
                        <p className="text-sm font-medium text-white">
                          退出登录
                        </p>
                      </div>
                    </a>
                  </div>
                  <div className="relative grid gap-8 bg-white p-2">
                    <a
                      onClick={() => {}}
                      className=" flex items-center rounded-lg hover:cursor-pointer py-2 transition duration-150 ease-in-out focus:outline-none"
                    >
                      <div className="ml-4">
                        <p className="text-sm font-medium text-black">
                          关于slep {appVersion}
                        </p>
                      </div>
                    </a>
                  </div>
                </div>
              </Popover.Panel>
            </Transition>
          </>
        </Popover>
        <DynamicTopRightOption />
      </div>
      <div
        className={classNames(
          'flex grow bg-gradient-to-b from-[#394A6A] to-[#293451]'
        )}
      >
        <div className={classNames('w-[64px] h-full shrink-0 px-1 ')}>
          <Tab.Group>
            <Tab.List className={classNames('flex flex-col gap-y-1')}>
              <Tab
                onClick={() => {
                  router.push('/');
                }}
                className={classNames('focus:outline-none')}
              >
                {({ selected }) => (
                  <div
                    className={classNames(
                      'w-full h-14 rounded-lg hover:bg-[#273248] flex flex-col justify-center items-center',
                      { 'bg-[#273248]': selected }
                    )}
                  >
                    <svg
                      className={classNames('w-7 h-7')}
                      viewBox="0 0 1024 1024"
                      version="1.1"
                      xmlns="http://www.w3.org/2000/svg"
                      p-id="9987"
                      width="200"
                      height="200"
                    >
                      <path
                        d="M619.349333 343.722667a231.253333 231.253333 0 0 0-256-108.885334l-10.922666-19.285333a64.341333 64.341333 0 1 0-111.445334 64.341333l11.093334 19.114667a231.594667 231.594667 0 0 0-34.133334 276.138667l162.986667 282.112 401.237333-231.594667z"
                        fill="#FFC670"
                        p-id="9988"
                      ></path>
                      <path
                        d="M819.2 560.128a25.770667 25.770667 0 0 0-38.570667-22.357333l-229.888 132.437333-98.986666 57.173333a85.333333 85.333333 0 0 1-115.882667-31.061333l-65.706667-114.005333A256 256 0 0 1 273.066667 318.634667a210.261333 210.261333 0 0 1 111.104-87.893334 230.4 230.4 0 0 0-109.397334 47.957334 237.226667 237.226667 0 0 0-51.2 302.933333l120.490667 208.725333-21.845333 11.776a40.106667 40.106667 0 0 0-17.066667 51.2A38.4 38.4 0 0 0 358.4 870.4l22.357333-12.8 24.405334-14.165333L779.946667 627.029333a85.333333 85.333333 0 0 0 39.253333-66.901333z"
                        fill="#FFE88A"
                        p-id="9989"
                      ></path>
                      <path
                        d="M779.946667 537.770667l-36.352 21.162666-124.245334-215.210666a231.424 231.424 0 0 0-316.245333-85.333334c-6.314667 3.584-12.288 7.509333-18.090667 11.605334A231.594667 231.594667 0 0 1 554.666667 375.466667l69.632 120.661333a113.834667 113.834667 0 0 1-41.642667 155.477333L460.8 722.432l-70.826667 40.96L322.218667 802.133333a40.106667 40.106667 0 0 0-17.066667 51.2A38.4 38.4 0 0 0 358.4 870.4l22.357333-12.8 100.693334-58.197333a115.882667 115.882667 0 0 0 199.509333-115.2l100.693333-58.197334A80.896 80.896 0 0 0 819.2 563.2v-2.56a25.770667 25.770667 0 0 0-39.253333-22.869333z"
                        fill="#FF9A42"
                        p-id="9990"
                      ></path>
                      <path
                        d="M621.568 698.026667m-69.632 0a69.632 69.632 0 1 0 139.264 0 69.632 69.632 0 1 0-139.264 0Z"
                        fill="#FFC670"
                        p-id="9991"
                      ></path>
                      <path
                        d="M550.741333 670.208L765.952 546.133333a38.570667 38.570667 0 0 1 52.565333 14.165334 38.570667 38.570667 0 0 1-13.994666 52.736L358.4 870.4a38.570667 38.570667 0 0 1-52.736-14.165333 38.570667 38.570667 0 0 1 14.165333-52.565334l69.12-39.936"
                        fill="#FF9A42"
                        p-id="9992"
                      ></path>
                      <path
                        d="M536.234667 148.821333A24.576 24.576 0 0 0 512 173.397333V392.533333a12.288 12.288 0 0 0 20.992 8.704l57.173333-57.002666h221.866667A24.746667 24.746667 0 0 0 836.266667 318.976v-145.578667a24.576 24.576 0 0 0-24.746667-24.576z"
                        fill="#96DDFF"
                        p-id="9993"
                      ></path>
                      <path
                        d="M532.48 400.725333l57.173333-57.002666h221.866667A24.746667 24.746667 0 0 0 836.266667 318.976v-145.578667a24.576 24.576 0 0 0-24.746667-24.576h-12.8c0 48.810667-3.072 127.829333-26.453333 127.829334h-221.866667A51.2 51.2 0 0 0 512 325.973333V392.533333a12.288 12.288 0 0 0 20.48 8.192z"
                        fill="#69BAF9"
                        p-id="9994"
                      ></path>
                      <path
                        d="M812.032 131.754667H536.234667A41.813333 41.813333 0 0 0 494.933333 173.397333v49.322667a245.589333 245.589333 0 0 0-122.538666-7.509333l-4.778667-8.192a81.408 81.408 0 0 0-140.970667 81.408l4.949334 8.533333a248.661333 248.661333 0 0 0-27.477334 286.72L319.317333 785.066667l-7.509333 4.266666a55.637333 55.637333 0 0 0 55.637333 96.426667L477.866667 821.077333a132.778667 132.778667 0 0 0 224.426666-129.536l110.592-64a55.637333 55.637333 0 0 0-55.637333-96.256l-7.509333 4.266667L648.533333 360.618667h163.157334A41.813333 41.813333 0 0 0 853.333333 318.976v-145.578667a41.813333 41.813333 0 0 0-41.301333-41.642666zM273.066667 206.848a47.274667 47.274667 0 0 1 64.512 17.066667 265.386667 265.386667 0 0 0-43.349334 19.456A254.464 254.464 0 0 0 256 271.701333a47.104 47.104 0 0 1 17.066667-64.853333z m351.914666 609.621333a98.133333 98.133333 0 0 1-116.394666-12.970666l163.328-94.378667a97.962667 97.962667 0 0 1-46.933334 107.349333z m95.232-263.850666l-178.005333 102.4a17.066667 17.066667 0 0 0-6.314667 23.210666 17.066667 17.066667 0 0 0 23.381334 6.314667l215.210666-124.245333A21.504 21.504 0 1 1 795.989333 597.333333L350.378667 855.381333a21.504 21.504 0 0 1-21.504-37.376l69.12-39.936a17.066667 17.066667 0 1 0-17.066667-29.525333L348.842667 768l-115.712-201.386667a214.698667 214.698667 0 0 1 78.506666-293.546666A211.968 211.968 0 0 1 494.933333 259.072V392.533333a29.184 29.184 0 0 0 17.066667 26.624 28.672 28.672 0 0 0 32.085333-6.314666L597.333333 360.618667h12.8zM819.2 318.976a7.68 7.68 0 0 1-7.68 7.509333h-221.866667a17.066667 17.066667 0 0 0-12.117333 5.12L529.066667 380.586667V173.397333a7.68 7.68 0 0 1 7.68-7.509333h275.285333a7.68 7.68 0 0 1 7.68 7.509333z"
                        fill="#3D3D63"
                        p-id="9995"
                      ></path>
                      <path
                        d="M591.530667 232.789333h51.2a17.066667 17.066667 0 0 0 0-34.133333h-51.2a17.066667 17.066667 0 0 0 0 34.133333zM738.304 259.584h-146.773333a17.066667 17.066667 0 0 0 0 34.133333h146.773333a17.066667 17.066667 0 0 0 0-34.133333zM451.754667 707.754667l-14.848 8.533333a17.066667 17.066667 0 1 0 17.066666 29.525333l14.848-8.533333a17.066667 17.066667 0 0 0 6.144-23.381333 17.066667 17.066667 0 0 0-23.210666-6.144z"
                        fill="#3D3D63"
                        p-id="9996"
                      ></path>
                    </svg>
                    <span
                      className={classNames('text-xs text-[#D4D7DE] scale-90')}
                    >
                      消息
                    </span>
                  </div>
                )}
              </Tab>
              <Tab
                onClick={() => {
                  router.push('/oa');
                }}
                className={classNames('focus:outline-none')}
              >
                {({ selected }) => (
                  <div
                    className={classNames(
                      'w-full h-14 rounded-lg hover:bg-[#273248] flex flex-col justify-center items-center',
                      { 'bg-[#273248]': selected }
                    )}
                  >
                    <svg
                      className={classNames('w-5 h-5')}
                      viewBox="0 0 1204 1024"
                      version="1.1"
                      xmlns="http://www.w3.org/2000/svg"
                      p-id="14129"
                      width="200"
                      height="200"
                    >
                      <path
                        d="M0 0m84.453608 0l1035.23233 0q84.453608 0 84.453608 84.453608l0 669.801567q0 84.453608-84.453608 84.453609l-1035.23233 0q-84.453608 0-84.453608-84.453609l0-669.801567q0-84.453608 84.453608-84.453608Z"
                        fill="#D6E0E8"
                        p-id="14130"
                      ></path>
                      <path
                        d="M47.716289 33.190268m84.453608 0l939.799752 0q84.453608 0 84.453609 84.453608l0 603.421031q0 84.453608-84.453609 84.453608l-939.799752 0q-84.453608 0-84.453608-84.453608l0-603.421031q0-84.453608 84.453608-84.453608Z"
                        fill="#8DDFFF"
                        p-id="14131"
                      ></path>
                      <path
                        d="M712.112825 955.001402H492.026722l19.67769-116.292618h180.730722l19.677691 116.292618z"
                        fill="#244F60"
                        p-id="14132"
                      ></path>
                      <path
                        d="M693.533031 838.708784h-33.274722l17.650804 116.292618h33.190268l-17.56635-116.292618z"
                        fill="#19355E"
                        opacity=".47"
                        p-id="14133"
                      ></path>
                      <path
                        d="M413.82268 955.001402h376.663093a68.998598 68.998598 0 0 1 68.998598 68.998598h-515.16701a68.998598 68.998598 0 0 1 69.505319-68.998598z"
                        fill="#2E5A70"
                        p-id="14134"
                      ></path>
                      <path
                        d="M790.485773 955.001402h-41.466721a68.914144 68.914144 0 0 1 68.914144 68.914144h41.551175a68.914144 68.914144 0 0 0-68.998598-68.914144z"
                        fill="#19355E"
                        opacity=".47"
                        p-id="14135"
                      ></path>
                      <path
                        d="M602.069773 780.604701m-24.913814 0a24.913814 24.913814 0 1 0 49.827629 0 24.913814 24.913814 0 1 0-49.827629 0Z"
                        fill="#FFFFFF"
                        p-id="14136"
                      ></path>
                      <path
                        d="M1133.53633 755.690887v-41.551176H0v41.551176a83.017897 83.017897 0 0 0 83.017897 83.017897h967.500536a83.017897 83.017897 0 0 0 83.017897-83.017897z"
                        fill="#2E5A70"
                        p-id="14137"
                      ></path>
                      <path
                        d="M1167.48668 824.520577a78.457402 78.457402 0 0 1-14.103752 7.685279 78.457402 78.457402 0 0 0 14.103752-7.685279zM1203.717278 764.136247a77.866227 77.866227 0 0 1-3.378144 16.215093 77.866227 77.866227 0 0 0 3.378144-16.215093zM1121.037196 0h-70.518763a83.017897 83.017897 0 0 1 83.017897 83.017897v631.121814h70.603216V83.017897A83.102351 83.102351 0 0 0 1121.037196 0zM1173.905155 819.791175a84.453608 84.453608 0 0 0 20.184412-24.491546 84.453608 84.453608 0 0 1-20.184412 24.491546z"
                        fill="#F0F5FF"
                        opacity=".33"
                        p-id="14138"
                      ></path>
                      <path
                        d="M1133.53633 755.690887a83.017897 83.017897 0 0 1-83.017897 83.017897h70.518763a82.257814 82.257814 0 0 0 32.345732-6.502928 78.457402 78.457402 0 0 0 14.103752-7.685279 69.75868 69.75868 0 0 0 6.418475-4.729402 84.453608 84.453608 0 0 0 20.184412-24.491546 83.355711 83.355711 0 0 0 6.249567-14.948289 77.866227 77.866227 0 0 0 3.378144-16.215093c0-2.786969 0.422268-5.573938 0.422268-8.44536v-41.551176h-70.603216z"
                        fill="#0459A5"
                        p-id="14139"
                      ></path>
                      <path
                        d="M1133.53633 755.690887a83.017897 83.017897 0 0 1-83.017897 83.017897h70.518763a82.257814 82.257814 0 0 0 32.345732-6.502928 78.457402 78.457402 0 0 0 14.103752-7.685279 69.75868 69.75868 0 0 0 6.418475-4.729402 84.453608 84.453608 0 0 0 20.184412-24.491546 83.355711 83.355711 0 0 0 6.249567-14.948289 77.866227 77.866227 0 0 0 3.378144-16.215093c0-2.786969 0.422268-5.573938 0.422268-8.44536v-41.551176h-70.603216z"
                        fill="#153D4C"
                        p-id="14140"
                      ></path>
                      <path
                        d="M583.321072 383.166021c0 114.688-68.914144 213.498722-202.68866 213.498721-129.382928 0-197.114722-93.996866-197.114721-212.147464 0-119.924124 74.825897-212.06301 202.68866-212.06301 120.515299 0 197.114722 84.538062 197.114721 210.711753z m-307.833402 0c0 80.484289 35.386062 141.37534 108.438433 141.37534 79.301938 0 107.340536-66.380536 107.340536-139.855175 0-78.372948-31.923464-139.770722-108.776247-139.770722-74.488082 0-107.002722 57.597361-107.002722 137.828289zM731.368247 495.48932l-32.176824 95.179216H611.528577L751.637113 178.450474h111.901031l146.104743 412.218062h-93.743506l-33.781443-95.179216zM862.778062 422.268041c-29.305402-87.07167-47.969649-142.642144-57.935175-179.717278h-0.591176C793.863918 283.426309 773.510598 348.03332 750.032495 422.268041z"
                        fill="#FF9831"
                        p-id="14141"
                      ></path>
                    </svg>
                    <span
                      className={classNames('text-xs text-[#D4D7DE] scale-90')}
                    >
                      事务流
                    </span>
                  </div>
                )}
              </Tab>
              <Tab
                onClick={() => {
                  router.push('/group');
                }}
                className={classNames('focus:outline-none')}
              >
                {({ selected }) => (
                  <div
                    className={classNames(
                      'w-full h-14 rounded-lg hover:bg-[#273248] flex flex-col justify-center items-center',
                      { 'bg-[#273248]': selected }
                    )}
                  >
                    <svg
                      className={classNames('w-7 h-7')}
                      viewBox="0 0 1024 1024"
                      version="1.1"
                      xmlns="http://www.w3.org/2000/svg"
                      p-id="11392"
                      width="200"
                      height="200"
                    >
                      <path
                        d="M512 405.333333m-106.666667 0a106.666667 106.666667 0 1 0 213.333334 0 106.666667 106.666667 0 1 0-213.333334 0Z"
                        fill="#1296db"
                        p-id="11393"
                        data-spm-anchor-id="a313x.7781069.0.i3"
                      ></path>
                      <path
                        d="M627.2 512h-12.8c-25.6 0-64 38.4-102.4 38.4-38.4 0-72.533333-38.4-102.4-38.4h-12.8c-42.666667 0-64 25.6-76.8 64-21.333333 64-59.733333 179.2-38.4 238.933333 17.066667 38.4 34.133333 81.066667 76.8 81.066667h307.2c42.666667 0 64-46.933333 76.8-85.333333 21.333333-55.466667-12.8-166.4-38.4-226.133334-17.066667-38.4-34.133333-72.533333-76.8-72.533333z"
                        fill="#1296db"
                        p-id="11394"
                        data-spm-anchor-id="a313x.7781069.0.i2"
                      ></path>
                      <path
                        d="M320 213.333333m-85.333333 0a85.333333 85.333333 0 1 0 170.666666 0 85.333333 85.333333 0 1 0-170.666666 0Z"
                        fill=""
                        p-id="11395"
                      ></path>
                      <path
                        d="M281.6 563.2c8.533333-21.333333 29.866667-85.333333 98.133333-93.866667-8.533333-21.333333-17.066667-42.666667-17.066666-64 0-42.666667 17.066667-81.066667 46.933333-106.666666h-8.533333c-21.333333 0-46.933333 29.866667-81.066667 29.866666-29.866667 0-59.733333-29.866667-81.066667-29.866666h-12.8c-34.133333 0-51.2 21.333333-64 55.466666-17.066667 51.2-51.2 136.533333-29.866666 183.466667 12.8 34.133333 29.866667 59.733333 64 59.733333h72.533333c4.266667-12.8 8.533333-21.333333 12.8-34.133333z"
                        fill=""
                        p-id="11396"
                      ></path>
                      <path
                        d="M704 213.333333m-85.333333 0a85.333333 85.333333 0 1 0 170.666666 0 85.333333 85.333333 0 1 0-170.666666 0Z"
                        fill=""
                        p-id="11397"
                      ></path>
                      <path
                        d="M746.666667 563.2c-8.533333-21.333333-29.866667-85.333333-98.133334-93.866667 8.533333-21.333333 17.066667-42.666667 17.066667-64 0-42.666667-17.066667-81.066667-46.933333-106.666666h4.266666c21.333333 0 51.2 29.866667 81.066667 29.866666s59.733333-29.866667 81.066667-29.866666h12.8c34.133333 0 51.2 21.333333 64 55.466666 17.066667 51.2 51.2 136.533333 29.866666 183.466667-12.8 34.133333-29.866667 59.733333-64 59.733333h-72.533333c-4.266667-12.8-8.533333-21.333333-8.533333-34.133333z"
                        fill=""
                        p-id="11398"
                      ></path>
                    </svg>
                    <span
                      className={classNames('text-xs text-[#D4D7DE] scale-90')}
                    >
                      用户组
                    </span>
                  </div>
                )}
              </Tab>
            </Tab.List>
          </Tab.Group>
        </div>
        <main className={classNames('grow h-full bg-white rounded-tl-xl')}>
          {children}
        </main>
      </div>
    </div>
  );
};

export default Layout;
